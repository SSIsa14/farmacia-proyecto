ALTER SESSION SET CONTAINER = XEPDB1;
ALTER SESSION SET CURRENT_SCHEMA = PHARMACY_LOCAL;

CREATE TABLE VERIFICATION_TOKEN (
    ID_TOKEN         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TOKEN            VARCHAR2(100) UNIQUE NOT NULL,
    ID_USUARIO       NUMBER NOT NULL,
    FECHA_CREACION   TIMESTAMP DEFAULT SYSTIMESTAMP,
    FECHA_EXPIRACION TIMESTAMP NOT NULL,
    FECHA_VERIFICACION TIMESTAMP,
    CONSTRAINT fk_token_usuario FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE INDEX idx_verification_token ON VERIFICATION_TOKEN(TOKEN);

CREATE INDEX idx_verification_usuario ON VERIFICATION_TOKEN(ID_USUARIO);

ALTER TABLE USUARIO ADD (
    PERFIL_COMPLETO CHAR(1) DEFAULT 'N'
);

ALTER TABLE USUARIO ADD (
    PRIMER_LOGIN CHAR(1) DEFAULT 'Y'
);

UPDATE USUARIO SET PERFIL_COMPLETO = 'Y', PRIMER_LOGIN = 'N' WHERE ACTIVO = 'Y';

COMMIT; 
